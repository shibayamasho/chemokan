<h1>治療歴 詳細</h1>
<div class="back">
  <%= link_to '患者詳細へ戻る', patient_path(@patient.id) %>
</div>
<br />
<div class="patient-name">
  患者名：<%= @patient.name %>　<%= @patient.gender.name %>性　<%= ((Date.today.strftime("%Y%m%d").to_i - @patient.birthday.strftime("%Y%m%d").to_i) / 10000) %>歳
</div>
<div class="patient-disease">
  <%= @disease.cancer.name %>　<%= @disease.other.name %>　<%= @disease.purpose.name %>
</div>
<div>
  <a>【<%= @treatment.in_out.name %>】</a>
  <a><%= @treatment.date %></a>
</div>
<div class="plan-name-course">
  <a><%= @plan.name %></a>
  <a><%= @treatment.course %>コース目 day<%= @treatment.day %></a>
</div>
<div class="mesuring">
  <a>測定日：<%= @treatment.mesuring_date %></a>
  <a>身長：<%= @treatment.height %>cm</a>
  <a>体重：<%= @treatment.weight %>kg</a>
  <a>体表面積：<%= @bsa %>㎡（Du Bois法）</a>
</div>

<p><%= link_to 'レジメン選択・測定値などを編集', "/patients/#{params[:patient_id]}/treatments/edit2/#{params[:id]}", method: :get %></p>
<br>

<div class="treatment-details">
  
</div>

<table>
  <tr>
    <th>薬品名</th>
    <th>略号</th>
    <th>用量</th>
    <th>理論値</th>
    <th>投与量</th>
    <th>理論値％</th>
    <th>投与日</th>
  </tr>

  <tr class="medicine1">
    <td><%= @plan.medicine_name1 %></td>
    <td><%= @plan.abbreviation1 %></td>
    <td class="plan-dose"><%= @plan.dose1.to_s + @plan.unit1.name %></td>
    <td class="theoretical_value"><%= @theoretical_value1 %>mg</td>
    <td class="treatment-dose"><%= @treatment.dose1 %>mg</td>
    <td class="theoretical-percentage">
      <% if @treatment.dose1 != nil %>
        <%= (@treatment.dose1 * 100 / @theoretical_value1).round(1) %>％
      <% end %>
    </td>
    <td><%= @plan.schedule1 %></td>
  </tr>

  <% if @plan.medicine_name2 != "" %>
    <tr class="medicine2">
      <td><%= @plan.medicine_name2 %></td>
      <td><%= @plan.abbreviation2 %></td>
      <td class="plan-dose"><%= @plan.dose2.to_s + @plan.unit2.name %></td>
      <td class="theoretical_value"><%= @theoretical_value2 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose2 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose2 != nil %>
          <%= (@treatment.dose2 * 100 / @theoretical_value2).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule2 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name3 != "" %>
    <tr class="medicine3">
      <td><%= @plan.medicine_name3 %></td>
      <td><%= @plan.abbreviation3 %></td>
      <td class="plan-dose"><%= @plan.dose3.to_s + @plan.unit3.name %></td>
      <td class="theoretical_value"><%= @theoretical_value3 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose3 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose3 != nil %>
          <%= (@treatment.dose3 * 100 / @theoretical_value3).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule3 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name4 != "" %>
    <tr class="medicine4">
      <td><%= @plan.medicine_name4 %></td>
      <td><%= @plan.abbreviation4 %></td>
      <td class="plan-dose"><%= @plan.dose4.to_s + @plan.unit4.name %></td>
      <td class="theoretical_value"><%= @theoretical_value4 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose4 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose4 != nil %>
          <%= (@treatment.dose4 * 100 / @theoretical_value4).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule4 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name5 != "" %>
    <tr class="medicine5">
      <td><%= @plan.medicine_name5 %></td>
      <td><%= @plan.abbreviation5 %></td>
      <td class="plan-dose"><%= @plan.dose5.to_s + @plan.unit5.name %></td>
      <td class="theoretical_value"><%= @theoretical_value5 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose5 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose5 != nil %>
          <%= (@treatment.dose5 * 100 / @theoretical_value5).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule5 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name6 != "" %>
    <tr class="medicine6">
      <td><%= @plan.medicine_name6 %></td>
      <td><%= @plan.abbreviation6 %></td>
      <td class="plan-dose"><%= @plan.dose6.to_s + @plan.unit6.name %></td>
      <td class="theoretical_value"><%= @theoretical_value6 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose6 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose6 != nil %>
          <%= (@treatment.dose6 * 100 / @theoretical_value6).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule6 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name7 != "" %>
    <tr class="medicine7">
      <td><%= @plan.medicine_name7 %></td>
      <td><%= @plan.abbreviation7 %></td>
      <td class="plan-dose"><%= @plan.dose7.to_s + @plan.unit7.name %></td>
      <td class="theoretical_value"><%= @theoretical_value7 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose7 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose7 != nil %>
          <%= (@treatment.dose7 * 100 / @theoretical_value7).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule7 %></td>
    </tr>
  <% end %>

  <% if @plan.medicine_name8 != "" %>
    <tr class="medicine8">
      <td><%= @plan.medicine_name8 %></td>
      <td><%= @plan.abbreviation8 %></td>
      <td class="plan-dose"><%= @plan.dose8.to_s + @plan.unit8.name %></td>
      <td class="theoretical_value"><%= @theoretical_value8 %>mg</td>
      <td class="treatment-dose"><%= @treatment.dose8 %>mg</td>
      <td class="theoretical-percentage">
        <% if @treatment.dose8 != nil %>
          <%= (@treatment.dose8 * 100 / @theoretical_value8).round(1) %>％
        <% end %>
      </td>
      <td><%= @plan.schedule8 %></td>
    </tr>
  <% end %>

</table>

<h4>支持療法</h4>
<table class="support">
  <tr>
    <td>催吐性リスク</td><td><%= @plan.emetic.name %></td>
  </tr>
  <tr>
    <td>NK1</td><td><%= @treatment.nk1 %></td>
  </tr>
  <tr>
    <td>DEX</td><td><%= @treatment.dex %></td>
  </tr>
  <tr>
    <td>H1blocker</td><td><%= @treatment.h1blocker %></td>
  </tr>
  <tr>
    <td>H2blocker</td><td><%= @treatment.h2blocker %></td>
  </tr>
  <tr>
    <td>その他支持薬</td><td><%= @treatment.other_medicine %></td>
  </tr>
</table>

<div>補足：<%= @treatment.text %></div>

<p><%= link_to '用量等を編集', edit_patient_treatment_path(params[:patient_id], params[:id]) %></p>

<p><%= link_to 'この投与歴を削除', patient_treatment_path(params[:patient_id], params[:id]), method: :delete %></p>